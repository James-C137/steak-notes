---
import Card from './Card.astro';
import { CircleHelp, TriangleAlert, Lightbulb } from 'lucide-astro';

interface Props {
  type?: 'question' | 'warning' | 'tip';
  title?: string;
  collapsed?: boolean;
}

const { type = 'question', title, collapsed = false } = Astro.props;

const typeConfig = {
  question: { accent: 'sky', bg: 'bg-sky/25', text: 'text-sky', iconBg: 'bg-sky', Icon: CircleHelp },
  warning: { accent: 'ochre', bg: 'bg-ochre/25', text: 'text-ochre', iconBg: 'bg-ochre', Icon: TriangleAlert },
  tip: { accent: 'charcoal', bg: 'bg-charcoal/25', text: 'text-charcoal', iconBg: 'bg-charcoal', Icon: Lightbulb },
} as const;

const { accent, bg, text, iconBg, Icon } = typeConfig[type];
---

<Card
  as="aside"
  background={bg}
  accentColor={accent}
  collapsible={collapsed}
  margin={collapsed ? 'my-4' : 'my-8'}
  class={collapsed ? 'callout-collapsible' : ''}
>
  <Fragment slot="summary">
    <span class:list={['callout-header flex items-center gap-3', text]}>
      <span class="callout-icon inline-flex w-8 h-8 items-center justify-center rounded">
        <Icon size={16} />
      </span>
      <span class="callout-title">{title}</span>
    </span>
  </Fragment>

  {title && !collapsed && (
    <p class="font-black text-lg mb-2 mt-0 flex items-center gap-3">
      <span class:list={['inline-flex w-8 h-8 text-cream items-center justify-center rounded', iconBg]}>
        <Icon size={16} />
      </span>
      {title}
    </p>
  )}
  <slot />
</Card>

<style>
  .callout-header {
    --duration: 0.3s;
    --ease: cubic-bezier(0.4, 0, 0.2, 1);
    transition:
      color var(--duration) var(--ease),
      font-weight var(--duration) var(--ease),
      font-size var(--duration) var(--ease),
      margin-bottom var(--duration) var(--ease);
  }

  .callout-icon {
    transition: background-color var(--duration) var(--ease), color var(--duration) var(--ease);
  }

  .callout-title {
    border-bottom: 2px dotted currentColor;
    transition: border-color var(--duration) var(--ease);
  }

  /* Open state */
  :global(.callout-collapsible[open]) .callout-header {
    color: var(--color-charcoal);
    font-weight: 900;
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
  }

  :global(.callout-collapsible[open]) .callout-icon {
    background-color: var(--card-accent);
    color: var(--color-cream);
  }

  :global(.callout-collapsible[open]) .callout-title {
    border-color: transparent;
  }
</style>
